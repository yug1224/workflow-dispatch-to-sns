name: Workflow Dispatch to SNS
on:
  workflow_dispatch:
    inputs:
      message:
        description: '投稿するメッセージ'
        required: true
      image_url:
        description: '投稿する画像のURL'
        required: false
jobs:
  workflow-dispatch-to-sns:
    runs-on: macos-latest
    # 5分以上かかったらタイムアウト
    timeout-minutes: 5
    steps:
      # リポジトリのチェックアウト
      - name: Checkout
        uses: actions/checkout@v4
      # Cacheの復元
      - name: Cache Deno Deps
        uses: actions/cache@v4
        with:
          path: |
            ~/.deno
            ~/.cache/deno
          key: ${{ hashFiles('deno.lock') }}
      # Denoのセットアップ
      - name: Setup Deno
        uses: denoland/setup-deno@v1
        with:
          deno-version: v1.x
      # Denoの実行
      - name: Deno Run
        run: deno run --allow-read --allow-write --allow-env --allow-net main.ts
        env:
          BLUESKY_IDENTIFIER: ${{secrets.BLUESKY_IDENTIFIER}}
          BLUESKY_PASSWORD: ${{secrets.BLUESKY_PASSWORD}}
          WEBHOOK_URL: ${{secrets.WEBHOOK_URL}}
          WEBHOOK_URL_WITH_IMAGE: ${{secrets.WEBHOOK_URL_WITH_IMAGE}}
          MESSAGE: ${{github.event.inputs.message}}
          IMAGE_URL: ${{github.event.inputs.image_url}}
